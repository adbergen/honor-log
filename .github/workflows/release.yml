name: Release

on:
  push:
    tags:
      - "v*"

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create addon package
        run: |
          mkdir -p release
          rsync -av --exclude='.git*' --exclude='.github' --exclude='release' --exclude='*.md' --exclude='ROADMAP.md' ./ release/HonorLog/
          cd release && zip -r HonorLog-${{ github.ref_name }}.zip HonorLog

      - name: Upload to CurseForge
        uses: itsmeow/curseforge-upload@v3
        with:
          token: ${{ secrets.CURSEFORGE_TOKEN }}
          project_id: 1442154 # Replace with your actual CurseForge project ID
          game_endpoint: wow
          file_path: release/HonorLog-${{ github.ref_name }}.zip
          changelog: "See CHANGELOG.md for details"
          changelog_type: text
          display_name: HonorLog ${{ github.ref_name }}
          game_versions: "WoW Burning Crusade Classic,2.5.4"
          release_type: release

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: release/HonorLog-${{ github.ref_name }}.zip
          generate_release_notes: true
